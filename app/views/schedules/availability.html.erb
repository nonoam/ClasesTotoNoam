<div class="container py-5">
  <h1 class="page-title">Horarios Disponibles</h1>
  
  <div class="filters-bar">
    <%= form_with url: schedules_availability_path, method: :get, 
        data: { turbo_frame: "calendar" } do |f| %>
      <div class="filter-group">
        <%= f.label :tutor_id, "Tutor:" %>
        <%= f.select :tutor_id, 
            options_for_select([["Todos", ""]] + 
            @tutors.map { |t| [t.name, t.id] }, params[:tutor_id]),
            {}, class: "form-select" %>
      </div>
      <div class="filter-group">
        <%= f.label :date, "Semana:" %>
        <%= f.week_field :date, value: @date, class: "form-control" %>
      </div>
      <%= f.submit "Filtrar", class: "btn btn-primary" %>
    <% end %>
  </div>
  
  <div id="calendar" class="calendar-container">
    <div class="calendar-header">
      <% 7.times do |i| %>
        <% day = @date.beginning_of_week + i.days %>
        <div class="calendar-day-header">
          <div class="day-name"><%= l(day, format: "%A") %></div>
          <div class="day-number"><%= day.day %></div>
        </div>
      <% end %>
    </div>
    
    <div class="calendar-body">
      <% 7.times do |i| %>
        <% day = @date.beginning_of_week + i.days %>
        <div class="calendar-day">
          <% if @available_slots[day] %>
            <% @available_slots[day].each do |schedule| %>
              <div class="time-slot <%= 'available' if schedule.available %>" 
                   data-schedule-id="<%= schedule.id %>">
                <div class="slot-time">
                  <%= schedule.start_time.strftime("%H:%M") %> - 
                  <%= schedule.end_time.strftime("%H:%M") %>
                </div>
                <div class="slot-tutor">
                  <%= schedule.tutor.name %>
                </div>
                <% if schedule.available %>
                  <%= link_to "Reservar", 
                      new_booking_path(schedule_id: schedule.id),
                      class: "btn btn-sm btn-success",
                      data: { turbo_frame: "_top" } %>
                <% else %>
                  <span class="badge badge-secondary">Ocupado</span>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="no-slots">Sin horarios</div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%= turbo_frame_tag "calendar" do %>
  <!-- El contenido del calendario se actualiza aquÃ­ con Turbo -->
<% end %>