<div class="container py-5">
  <div class="booking-form-container">
    <h1 class="page-title">Reservar Clase</h1>
    
    <%= form_with model: @booking, data: { turbo: false } do |f| %>
      <div class="form-section">
        <h3>Información del Estudiante</h3>
        
        <div class="form-group">
          <%= f.label :student_name, "Nombre completo *" %>
          <%= f.text_field :student_name, class: "form-control", required: true %>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <%= f.label :student_email, "Email *" %>
            <%= f.email_field :student_email, class: "form-control", required: true %>
          </div>
          
          <div class="form-group">
            <%= f.label :student_phone, "Teléfono" %>
            <%= f.text_field :student_phone, class: "form-control" %>
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <h3>Detalles de la Clase</h3>
        
        <div class="form-row">
          <div class="form-group">
            <%= f.label :tutor_id, "Tutor *" %>
            <%= f.select :tutor_id, 
                options_for_select(@tutors.map { |t| [t.name, t.id] }),
                { prompt: "Selecciona un tutor" },
                class: "form-control", required: true,
                data: { action: "change->booking#updateSchedules" } %>
          </div>
          
          <div class="form-group">
            <%= f.label :subject_id, "Materia *" %>
            <%= f.select :subject_id,
                grouped_options_for_select(
                  @subjects.group_by(&:category).map { |cat, subs| 
                    [cat, subs.map { |s| [s.name, s.id] }] 
                  }
                ),
                { prompt: "Selecciona una materia" },
                class: "form-control", required: true %>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <%= f.label :class_date, "Fecha de la clase *" %>
            <%= f.datetime_field :class_date, 
                class: "form-control", 
                min: DateTime.current,
                required: true %>
          </div>
          
          <div class="form-group">
            <%= f.label :schedule_id, "Horario disponible" %>
            <%= f.select :schedule_id,
                [],
                { prompt: "Selecciona primero un tutor" },
                class: "form-control",
                data: { target: "booking.scheduleSelect" } %>
          </div>
        </div>
        
        <div class="form-group">
          <label>Tipo de clase *</label>
          <div class="radio-group">
            <label class="radio-label">
              <%= f.radio_button :class_type, "individual", 
                  checked: true,
                  data: { action: "change->booking#updatePrice" } %>
              <span>Individual (1.5 horas - $25,000 CLP)</span>
            </label>
            <label class="radio-label">
              <%= f.radio_button :class_type, "group",
                  data: { action: "change->booking#updatePrice" } %>
              <span>Grupal (mínimo 3 personas - $10,000 CLP por persona)</span>
            </label>
          </div>
        </div>
        
        <div class="form-group" data-target="booking.groupSize" style="display: none;">
          <%= f.label :number_of_students, "Número de estudiantes" %>
          <%= f.number_field :number_of_students, 
              value: 1, min: 1, max: 10,
              class: "form-control",
              data: { action: "change->booking#updatePrice" } %>
        </div>
        
        <div class="form-group">
          <%= f.label :notes, "Notas adicionales (opcional)" %>
          <%= f.text_area :notes, rows: 3, class: "form-control",
              placeholder: "Temas específicos que te gustaría cubrir, nivel actual, etc." %>
        </div>
      </div>
      
      <div class="price-summary">
        <h3>Resumen del Precio</h3>
        <div class="price-display" data-target="booking.priceDisplay">
          <span>Total a pagar:</span>
          <strong>$<span data-target="booking.totalPrice">25,000</span> CLP</strong>
        </div>
      </div>
      
      <div class="form-actions">
        <%= f.submit "Confirmar Reserva", class: "btn btn-primary btn-lg" %>
        <%= link_to "Cancelar", root_path, class: "btn btn-outline" %>
      </div>
    <% end %>
  </div>
</div>